<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaÄŸlÄ±k AsistanÄ± - AI Obezite DanÄ±ÅŸmanÄ±</title>
    <meta name="description" content="Llama AI ile desteklenen kiÅŸiselleÅŸtirilmiÅŸ saÄŸlÄ±k danÄ±ÅŸmanÄ±">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¤–</text></svg>">
</head>
<body>
    <div class="chat-container">
        <!-- Header -->
        <header class="chat-header">
            <a href="index.html" class="back-button">
                â† Ana Sayfa
            </a>
            
            <h1>ğŸ¤– SaÄŸlÄ±k AsistanÄ±</h1>
            <p>Llama AI ile desteklenen kiÅŸiselleÅŸtirilmiÅŸ saÄŸlÄ±k danÄ±ÅŸmanÄ±</p>
            
            <div class="status-indicator">
                <div class="status-dot offline" id="statusDot"></div>
                <span id="statusText">BaÄŸlantÄ± kontrol ediliyor...</span>
            </div>
        </header>

        <!-- Ana Ä°Ã§erik -->
        <main class="chat-main">
            <!-- Yan Panel -->
            <aside class="chat-sidebar">
                <!-- SaÄŸlÄ±k Ã–zeti -->
                <section class="sidebar-section">
                    <h3>ğŸ“Š SaÄŸlÄ±k Ã–zetiniz</h3>
                    <div class="health-summary" id="healthSummary">
                        <div class="summary-item">
                            <span>BMI:</span>
                            <span class="summary-value" id="summaryBMI">-</span>
                        </div>
                        <div class="summary-item">
                            <span>Durum:</span>
                            <span class="summary-value" id="summaryStatus">-</span>
                        </div>
                        <div class="summary-item">
                            <span>YaÅŸ:</span>
                            <span class="summary-value" id="summaryAge">-</span>
                        </div>
                        <div class="summary-item">
                            <span>Cinsiyet:</span>
                            <span class="summary-value" id="summaryGender">-</span>
                        </div>
                    </div>
                </section>

                <!-- HÄ±zlÄ± Sorular -->
                <section class="sidebar-section">
                    <h3>ğŸ’¡ HÄ±zlÄ± Sorular</h3>
                    <div class="quick-questions">
                        <button class="quick-question" data-question="Durumumu nasÄ±l deÄŸerlendiriyorsun?">
                            Durumumu nasÄ±l deÄŸerlendiriyorsun?
                        </button>
                        <button class="quick-question" data-question="Hangi besinleri tÃ¼ketmeli/tÃ¼ketmemeli?">
                            Beslenme Ã¶nerilerin neler?
                        </button>
                        <button class="quick-question" data-question="Hangi egzersizleri yapmalÄ±yÄ±m?">
                            Hangi egzersizleri yapmalÄ±yÄ±m?
                        </button>
                        <button class="quick-question" data-question="Kilo vermek iÃ§in ne kadar sÃ¼re gerekir?">
                            Kilo vermek iÃ§in ne kadar sÃ¼re gerekir?
                        </button>
                        <button class="quick-question" data-question="Motivasyonum dÃ¼ÅŸtÃ¼, bana tavsiyeler verir misin?">
                            Motivasyon tavsiyeleri verir misin?
                        </button>
                        <button class="quick-question" data-question="GÃ¼nlÃ¼k rutinimde hangi deÄŸiÅŸiklikleri yapmalÄ±yÄ±m?">
                            YaÅŸam tarzÄ± Ã¶nerilerini anlat
                        </button>
                    </div>
                </section>
            </aside>

            <!-- Chat AlanÄ± -->
            <section class="chat-area">
                <!-- Mesajlar -->
                <div class="chat-messages" id="chatMessages">
                    <!-- HoÅŸ geldin mesajÄ± -->
                    <div class="message assistant">
                        <div class="message-avatar">ğŸ¤–</div>
                        <div class="message-content">
                            <div class="message-bubble">
                                <h3>ğŸ¥ Merhaba! SaÄŸlÄ±k AsistanÄ±nÄ±zÄ±m</h3>
                                <p>Size kiÅŸiselleÅŸtirilmiÅŸ saÄŸlÄ±k Ã¶nerileri sunmak iÃ§in buradayÄ±m. Obezite, beslenme, egzersiz ve saÄŸlÄ±klÄ± yaÅŸam konularÄ±nda sorularÄ±nÄ±zÄ± yanÄ±tlayabilirim.</p>
                                
                                <p><strong>ğŸ’¡ Ä°pucu:</strong> Daha kiÅŸiselleÅŸtirilmiÅŸ Ã¶neriler iÃ§in ana sayfada obezite tahmini yaptÄ±rÄ±p sonuÃ§larÄ±nÄ±zÄ± buraya aktarabilirsiniz.</p>
                                
                                <p><strong>âš ï¸ Ã–nemli:</strong> Ben bir saÄŸlÄ±k asistanÄ±yÄ±m, tÄ±bbi tanÄ± koymam. Ciddi saÄŸlÄ±k sorunlarÄ± iÃ§in mutlaka doktorunuza danÄ±ÅŸÄ±n.</p>
                                
                                <p>Size nasÄ±l yardÄ±mcÄ± olabilirim? ğŸ˜Š</p>
                            </div>
                            <div class="message-time" id="welcomeTime"></div>
                        </div>
                    </div>
                </div>

                <!-- Input AlanÄ± -->
                <div class="chat-input-area">
                    <div class="chat-input-container">
                        <textarea 
                            id="chatInput" 
                            class="chat-input" 
                            placeholder="SaÄŸlÄ±k sorunuzu yazÄ±n... (Ã–rn: Hangi besinlerden kaÃ§Ä±nmalÄ±yÄ±m?)"
                            rows="1"
                        ></textarea>
                        <button id="sendButton" class="send-button" title="GÃ¶nder">
                            â¤
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- JavaScript -->
    <script src="js/chat.js"></script>
    <script>
        // Sayfa yÃ¼klendiÄŸinde hoÅŸ geldin mesajÄ±nÄ±n zamanÄ±nÄ± ayarla
        document.addEventListener('DOMContentLoaded', function() {
            const welcomeTime = document.getElementById('welcomeTime');
            if (welcomeTime) {
                welcomeTime.textContent = new Date().toLocaleTimeString('tr-TR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            // URL'den gelen saÄŸlÄ±k verilerini kontrol et
            const urlParams = new URLSearchParams(window.location.search);
            const healthData = urlParams.get('data');
            
            if (healthData) {
                try {
                    const data = JSON.parse(decodeURIComponent(healthData));
                    // SaÄŸlÄ±k verilerini yÃ¼kle
                    loadHealthData(data);
                    // Otomatik saÄŸlÄ±k analizi baÅŸlat
                    setTimeout(() => {
                        requestHealthAnalysis(data);
                    }, 1000);
                } catch (e) {
                    console.warn('SaÄŸlÄ±k verisi parse edilemedi:', e);
                }
            }
        });
        
        function loadHealthData(data) {
            const summaryBMI = document.getElementById('summaryBMI');
            const summaryStatus = document.getElementById('summaryStatus');
            const summaryAge = document.getElementById('summaryAge');
            const summaryGender = document.getElementById('summaryGender');
            
            if (data.prediction && data.input_data) {
                summaryBMI.textContent = data.prediction.bmi || '-';
                summaryStatus.textContent = data.prediction.predicted_class || '-';
                summaryAge.textContent = data.input_data.age || '-';
                summaryGender.textContent = data.input_data.gender === 'Male' ? 'Erkek' : 'KadÄ±n';
                
                // SaÄŸlÄ±k verilerini global deÄŸiÅŸkende sakla
                window.healthContext = data;
            }
        }
        
        function requestHealthAnalysis(data) {
            const message = `Merhaba! Az Ã¶nce obezite tahmini yaptÄ±rdÄ±m ve sonuÃ§larÄ±m geldi. Durumumu analiz edip Ã¶neriler verir misin?

ğŸ“Š SonuÃ§larÄ±m:
- BMI: ${data.prediction?.bmi}
- Obezite Seviyesi: ${data.prediction?.predicted_class}
- Tahmin GÃ¼veni: %${data.prediction?.confidence}

Bana Ã¶zel Ã¶neriler bekliyorum! ğŸ˜Š`;

            // MesajÄ± otomatik olarak gÃ¶nder
            if (window.sendMessageWithContext) {
                window.sendMessageWithContext(message, data);
            }
        }
    </script>
</body>
</html>